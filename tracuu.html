<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Trang Tra cứu UCTT DUOCVK</title>
<script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; margin:0; background:#f0f2f5; }
  header { background:#007bff; color:#fff; padding:20px; text-align:center; font-size:24px; font-weight:bold; }
  .dashboard { display:flex; flex-wrap:wrap; justify-content:center; margin:40px 0; gap:20px; }
  .menu-button { background:#28a745; color:#fff; padding:20px 40px; border:none; border-radius:8px; font-size:18px; cursor:pointer; transition:0.3s; }
  .menu-button:hover { background:#218838; }
  #main-content { margin:20px auto; width:95%; min-height:600px; }
  .panel { border:1px solid #ccc; border-radius:8px; background:#fff; box-shadow:0 2px 6px rgba(0,0,0,0.1); margin-bottom:20px; overflow:hidden; }
  .panel-header { background:#007bff; color:#fff; padding:12px 16px; font-weight:bold; font-size:18px; }
  .panel-body { padding:16px; }
</style>
</head>
<body>

<header>Welcome đến trang tra cứu UCTT DUOCVK</header>

<div class="dashboard">
 <button class="menu-button" data-truc="2B">Trục 2B</button>
  <button class="menu-button" data-truc="1A">Trục 1A</button>
  <button class="menu-button" data-truc="1C">Trục 1C</button>
  <button class="menu-button" data-truc="1E">Trục 1E</button>
  <button class="menu-button" data-truc="ADC">Trục ADC</button>
  <button class="menu-button" data-truc="PRT">Link PRT</button>
  <button class="menu-button" data-truc="MT2">Liên tỉnh MT2</button>
  <button class="menu-button" data-truc="MT3.4">Liên tỉnh MT3_4</button>
  <button class="menu-button" data-truc="LH_Ciena">Liên huyện Ciena</button>
  <button class="menu-button" data-truc="LH_HW">Liên huyện HW</button>
  <button class="menu-button" data-truc="LH_AGG">Liên huyện AGG</button>
  <button class="menu-button" data-truc="Link SRT">SRT</button>
</div>

<div id="main-content">
  <p>Chọn một menu để bắt đầu tra cứu...</p>
</div>

<script>
const buttons = document.querySelectorAll('.menu-button');
const mainContent = document.getElementById('main-content');

// Tạo panel
function createPanel(title){
  mainContent.innerHTML = '';
  const panel = document.createElement('div');
  panel.className = 'panel';
  const header = document.createElement('div');
  header.className = 'panel-header';
  header.textContent = `Thông tin tra cứu ${title}`;
  panel.appendChild(header);
  const body = document.createElement('div');
  body.className = 'panel-body';
  panel.appendChild(body);
  mainContent.appendChild(panel);
  return body;
}

// Vẽ sơ đồ PRT
function drawPRT(body){
  body.innerHTML = '<div id="cy" style="width:100%; height:600px;"></div>';
  const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTB-HYIO9ky0tuYDvhnRNwN3mY8tDlp3hTyg3OcVUMgct_Lotow5IEdYWkDVt5nkVgFIILglkSvS4Dh/pub?output=csv";
  
  fetch(csvUrl).then(res=>res.text()).then(csv=>{
    const lines = csv.trim().split("\n");
    const nodesSet = new Set();
    const edges = [];

    for(let i=1;i<lines.length;i++){
      const line = lines[i].trim();
      if(!line) continue;
      const regex = /(.*) \((.*)\) - \((.*)\) (.*)/;
      const match = line.match(regex);
      if(match){
        const nodeA = match[1].trim();
        const portA = match[2].trim();
        const portB = match[3].trim();
        const nodeB = match[4].trim();
        nodesSet.add(nodeA);
        nodesSet.add(nodeB);
        edges.push({data:{source:nodeA,target:nodeB,label:`${portA} ⇄ ${portB}`}});
      }
    }

    const nodes = Array.from(nodesSet).map(n=>({data:{id:n,label:n}}));
    cytoscape({
      container: document.getElementById('cy'),
      elements:{nodes,edges},
      style:[
        {selector:'node', style:{'background-color':'#007bff','label':'data(id)','color':'#fff','text-valign':'center','text-halign':'center','font-size':12}},
        {selector:'edge', style:{'width':2,'line-color':'#555','target-arrow-shape':'triangle','target-arrow-color':'#555','curve-style':'bezier','label':'data(label)','font-size':10,'text-background-color':'#fff','text-background-opacity':1}}
      ],
      layout:{name:'cose',padding:30}
    });
  });
}

// Vẽ Trục 2B
function draw2B(body){
  body.innerHTML = '<div id="cy" style="width:100%; height:600px;"></div>';
  const csvUrl = "YOUR_GOOGLE_SHEET_TRUC2B_CSV_URL"; // Thay CSV thực tế

  fetch(csvUrl)
    .then(res=>res.text())
    .then(csv=>{
      const lines = csv.trim().split("\n");
      const nodesSet = new Set();
      const edges = [];
      const colors = { 'Main':'red', 'Pro':'green', 'DP':'orange' };

      // Tạo node và edge
      lines.forEach((line,i)=>{
        if(i===0) return; // bỏ header
        const parts = line.split(',');
        if(parts.length<3) return;

        const nodeStr = parts[0].trim();  // HTH8102DWB21-QBH8101DWB21
        const type = parts[1].trim();     // Main/Pro/DP
        const [source, target] = nodeStr.split('-');

        nodesSet.add(source);
        nodesSet.add(target);

        edges.push({
          data: {
            source: source,
            target: target,
            label: type,
            color: colors[type] || '#555'
          }
        });
      });

      // Tạo vị trí node
      const nodesArray = Array.from(nodesSet);
      const nodePositions = {};
      const leftNodes = [];
      const rightNodes = [];

      // Xác định node bên trái = tất cả node xuất hiện làm source
      edges.forEach(e=>{
        if(!leftNodes.includes(e.data.source)) leftNodes.push(e.data.source);
        if(!rightNodes.includes(e.data.target)) rightNodes.push(e.data.target);
      });

      // Gán vị trí cho node: source bên trái, target bên phải
      const startY = 100, gapY = 100;
      leftNodes.forEach((n,i)=>{
        nodePositions[n] = {x:150, y:startY + i*gapY};
      });
      rightNodes.forEach((n,i)=>{
        nodePositions[n] = {x:550, y:startY + i*gapY};
      });

      const nodes = nodesArray.map(n=>({data:{id:n,label:n}, position:nodePositions[n]}));

      cytoscape({
        container: document.getElementById('cy'),
        elements:{nodes, edges},
        style:[
          {selector:'node', style:{'background-color':'#007bff','label':'data(id)','color':'#fff','text-valign':'center','text-halign':'center','font-size':12}},
          {selector:'edge', style:{'width':4,'line-color':'data(color)','curve-style':'bezier','label':'data(label)','font-size':12,'text-background-color':'#fff','text-background-opacity':1}}
        ],
        layout:{name:'preset'}
      });
    });
}

// Click menu
buttons.forEach(btn=>{
  btn.addEventListener('click',()=>{
    const truc = btn.getAttribute('data-truc');
    const body = createPanel(truc);
    if(truc==='PRT') drawPRT(body);
    else if(truc==='2B') draw2B(body);
  });
});
</script>

</body>
</html>
