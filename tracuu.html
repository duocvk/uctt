<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Trang Tra cứu UCTT DUOCVK</title>
<script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; margin:0; background:#f0f2f5; }
  header { background:#007bff; color:#fff; padding:20px; text-align:center; font-size:24px; font-weight:bold; }
  .dashboard { display:flex; flex-wrap:wrap; justify-content:center; margin:40px 0; gap:20px; }
  .menu-button { background:#28a745; color:#fff; padding:20px 40px; border:none; border-radius:8px; font-size:18px; cursor:pointer; transition:0.3s; }
  .menu-button:hover { background:#218838; }
  #main-content { margin:20px auto; width:90%; min-height:600px; border:1px solid #ccc; border-radius:8px; background:#fff; padding:20px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
</style>
</head>
<body>

<header>Welcome đến trang tra cứu UCTT DUOCVK</header>

<div class="dashboard">
  <button class="menu-button" data-truc="2B">Trục 2B</button>
  <button class="menu-button" data-truc="1A">Trục 1A</button>
  <button class="menu-button" data-truc="1C">Trục 1C</button>
  <button class="menu-button" data-truc="1E">Trục 1E</button>
  <button class="menu-button" data-truc="ADC">Trục ADC</button>
  <button class="menu-button" data-truc="PRT">Link PRT</button>
  <button class="menu-button" data-truc="MT2">Liên tỉnh MT2</button>
  <button class="menu-button" data-truc="MT3.4">Liên tỉnh MT3_4</button>
  <button class="menu-button" data-truc="LH_Ciena">Liên huyện Ciena</button>
  <button class="menu-button" data-truc="LH_HW">Liên huyện HW</button>
  <button class="menu-button" data-truc="LH_AGG">Liên huyện AGG</button>
  <button class="menu-button" data-truc="Link SRT">SRT</button>
</div>

<div id="main-content">
  <p>Chọn một menu để bắt đầu tra cứu...</p>
</div>

<script>
const buttons = document.querySelectorAll('.menu-button');
const mainContent = document.getElementById('main-content');

buttons.forEach(btn => {
  btn.addEventListener('click', () => {
    const truc = btn.getAttribute('data-truc');

    if(truc === 'PRT') {
      // Xóa nội dung cũ
      mainContent.innerHTML = '<div id="cy" style="width:100%; height:600px;"></div>';

      // Tải và vẽ sơ đồ logic PRT
      const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTB-HYIO9ky0tuYDvhnRNwN3mY8tDlp3hTyg3OcVUMgct_Lotow5IEdYWkDVt5nkVgFIILglkSvS4Dh/pub?output=csv";

      fetch(csvUrl).then(res => res.text()).then(csv => {
        const lines = csv.trim().split("\n");
        const nodesSet = new Set();
        const edges = [];

        for(let i=1;i<lines.length;i++){
          const line = lines[i].trim();
          if(!line) continue;
          const regex = /(.*) \((.*)\) - \((.*)\) (.*)/;
          const match = line.match(regex);
          if(match){
            const nodeA = match[1].trim();
            const portA = match[2].trim();
            const portB = match[3].trim();
            const nodeB = match[4].trim();

            nodesSet.add(nodeA);
            nodesSet.add(nodeB);

            edges.push({data:{source:nodeA,target:nodeB,label:`${portA} ⇄ ${portB}`}});
          }
        }

        const nodes = Array.from(nodesSet).map(n => ({data:{id:n,label:n}}));

        cytoscape({
          container: document.getElementById('cy'),
          elements:{nodes,edges},
          style:[
            {selector:'node', style:{'background-color':'#007bff','label':'data(id)','color':'#fff','text-valign':'center','text-halign':'center','font-size':12}},
            {selector:'edge', style:{'width':2,'line-color':'#555','target-arrow-shape':'triangle','target-arrow-color':'#555','curve-style':'bezier','label':'data(label)','font-size':10,'text-background-color':'#fff','text-background-opacity':1}}
          ],
          layout:{name:'cose',padding:30}
        });

      });

    } else {
      // Các trục khác
      mainContent.innerHTML = `<h2>Tra cứu Trục ${truc}</h2><p>Nội dung tra cứu sẽ hiển thị tại đây...</p>`;
    }
  });
});
</script>

</body>
</html>
